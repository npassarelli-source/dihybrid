<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dihybrid Cross Tutor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #374151;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .container {
            max-width: 600px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            text-align: center;
            display: flex;
            flex-direction: column;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .punnett-grid {
            display: grid;
            grid-template-columns: repeat(5, minmax(0, 1fr));
            gap: 0.5rem;
        }
        .punnett-cell {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            border: 2px solid #e5e7eb;
            background-color: #ffffff;
            transition: all 0.3s ease-in-out;
        }
        .punnett-input {
            width: 100%;
            height: 100%;
            text-align: center;
            background-color: transparent;
            border: none;
            outline: none;
        }
        .gamete-header {
            font-weight: bold;
            color: #6d28d9;
            border-bottom: 2px solid #8b5cf6;
        }
        .gamete-side {
            font-weight: bold;
            color: #6d28d9;
            border-right: 2px solid #8b5cf6;
            writing-mode: vertical-rl;
            text-orientation: sideways-right;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div id="root" class="container"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        // Icons from Lucide React
        const Check = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-check"><path d="M20 6 9 17l-5-5"/></svg>;
        const X = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-x"><path d="M18 6 6 18M6 6l12 12"/></svg>;

        const App = () => {
          // Step 1: Introduction to Dihybrid Cross
          const STEPS = {
            INTRO: 'intro',
            PROBLEM: 'problem',
            FEMALE_GAMETES: 'female_gametes',
            MALE_GAMETES: 'male_gametes',
            PUNNETT_SQUARE_SETUP: 'punnett_square_setup',
            PUNNETT_SQUARE_FILL: 'punnett_square_fill',
            PRACTICE_PROBLEMS: 'practice_problems'
          };

          const [step, setStep] = useState(STEPS.INTRO);
          const [maleGameteInputs, setMaleGameteInputs] = useState(['', '', '', '']);
          const [maleGametesCorrect, setMaleGametesCorrect] = useState(false);
          const [punnettSquare, setPunnettSquare] = useState(Array(4).fill(null).map(() => Array(4).fill('')));
          const [punnettSquareFilled, setPunnettSquareFilled] = useState(false);
          const [questionIndex, setQuestionIndex] = useState(0);
          const [userAnswer, setUserAnswer] = useState('');
          const [feedback, setFeedback] = useState('');
          // State to hold cell-specific feedback for the Punnett Square
          const [punnettSquareFeedback, setPunnettSquareFeedback] = useState(Array(4).fill(null).map(() => Array(4).fill('')));
          // State for highlighting correct cells on correct answer
          const [highlightedCells, setHighlightedCells] = useState([]);
          
          // State to track the number of correct answers
          const [correctAnswersCount, setCorrectAnswersCount] = useState(0);
          // State to trigger the congratulatory screen
          const [showCongratulations, setShowCongratulations] = useState(false);

          // Define a constant array of practice questions
          const allPracticeQuestions = [
            {
              text: 'How many out of 16 offspring will have a Round, Yellow phenotype? Remember that Round (R) and Yellow (Y) are **dominant**, while wrinkled (r) and green (y) are **recessive**.',
              correctAnswers: ['9/16', '9'],
              hint: 'A dominant phenotype requires at least one dominant allele. Look for squares that contain at least one big **R** and at least one big **Y** allele.',
              highlight: [
                { row: 0, col: 0 }, { row: 0, col: 1 }, { row: 0, col: 2 },
                { row: 1, col: 0 }, { row: 1, col: 2 },
                { row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 3 },
                { row: 3, col: 1 }
              ]
            },
            {
              text: 'What percentage of offspring will have a wrinkled, green phenotype? Remember that Round (R) and Yellow (Y) are **dominant**, while wrinkled (r) and green (y) are **recessive**.',
              correctAnswers: ['6.25%', '6.25'],
              hint: 'Remember, a percentage is part / whole x 100. The "whole" is the total number of squares (16 for Dihybrid crosses). The "part" is however many squares apply to the specific trait being asked in the question.',
              highlight: [{ row: 3, col: 3 }]
            },
            {
              text: 'How many offspring will have a Round, green phenotype? Remember that Round (R) and Yellow (Y) are **dominant**, while wrinkled (r) and green (y) are **recessive**.',
              correctAnswers: ['3/16', '3'],
              hint: 'This phenotype is a combination of dominant and recessive traits. You need at least one dominant **R** allele and two recessive **y** alleles.',
              highlight: [{ row: 1, col: 1 }, { row: 1, col: 3 }, { row: 3, col: 0 }]
            },
            {
              text: 'What percentage of offspring will have a wrinkled, Yellow phenotype? Remember that Round (R) and Yellow (Y) are **dominant**, while wrinkled (r) and green (y) are **recessive**.',
              correctAnswers: ['18.75%', '18.75'],
              hint: 'Remember, a percentage is part / whole x 100. The "whole" is the total number of squares (16 for Dihybrid crosses). The "part" is however many squares apply to the specific trait being asked in the question.',
              highlight: [{ row: 2, col: 2 }, { row: 2, col: 3 }, { row: 3, col: 2 }]
            }
          ];

          // State to hold the shuffled questions
          const [shuffledQuestions, setShuffledQuestions] = useState([]);

          // UseEffect to shuffle questions on component mount
          useEffect(() => {
            // Fisher-Yates shuffle algorithm
            const shuffleArray = (array) => {
              const newArray = [...array];
              for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
              }
              return newArray;
            };
            setShuffledQuestions(shuffleArray(allPracticeQuestions));
          }, []); // Empty dependency array ensures this runs only once

          // UseEffect to reset feedback and highlights when the step changes
          useEffect(() => {
            setFeedback('');
            setPunnettSquareFeedback(Array(4).fill(null).map(() => Array(4).fill('')));
            setHighlightedCells([]);
          }, [step]);


          // Problem definition for RrYy x RrYy
          const parents = {
            female: 'RrYy',
            male: 'RrYy'
          };

          // Correct gametes for RrYy, in a canonical order for validation
          const correctGametes = ['RY', 'Ry', 'rY', 'ry'];
          
          // Correct Punnett Square results (pre-computed for RrYy x RrYy)
          const correctPunnettSquare = [
            ['RRYY', 'RRYy', 'RrYY', 'RrYy'],
            ['RRYy', 'RRyy', 'RrYy', 'Rryy'],
            ['RrYY', 'RrYy', 'rrYY', 'rrYy'],
            ['RrYy', 'Rryy', 'rrYy', 'rryy']
          ];

          // Helper function to normalize gamete string to a canonical form (e.g., 'yr' -> 'ry', 'Yr' -> 'rY')
          const normalizeGamete = (gamete) => {
            if (gamete.length !== 2) return '';
            const sortedChars = gamete.split('').sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
            return sortedChars.join('');
          };

          const handleMaleGameteChange = (e, index) => {
            const newInputs = [...maleGameteInputs];
            newInputs[index] = e.target.value.trim();
            setMaleGameteInputs(newInputs);

            const filledInputs = newInputs.filter(input => input.length > 0);
            
            // Check for completeness first
            if (filledInputs.length === 4) {
              // Normalize all inputs for validation
              const normalizedInputs = filledInputs.map(input => normalizeGamete(input));

              // Check if all normalized inputs are in the list of correct gametes
              const normalizedCorrectGametes = correctGametes.map(g => normalizeGamete(g));
              const allAreValidGametes = normalizedInputs.every(input => normalizedCorrectGametes.includes(input));
              
              // Check for uniqueness
              const uniqueInputsSet = new Set(normalizedInputs);
              const allAreUnique = uniqueInputsSet.size === 4;

              if (allAreValidGametes && allAreUnique) {
                setMaleGametesCorrect(true);
                setFeedback('Correct! You have all four unique gametes.');
              } else if (!allAreUnique) {
                setMaleGametesCorrect(false);
                setFeedback('It looks like you have a duplicate gamete. Remember, there are four unique combinations of alleles.');
              } else {
                setMaleGametesCorrect(false);
                setFeedback('One or more of your gametes is not a valid combination of R/r and Y/y alleles.');
              }
            } else {
              setMaleGametesCorrect(false);
              setFeedback(''); // Clear feedback if not all fields are filled
            }
          };

          const handlePunnettSquareChange = (e, row, col) => {
            const newSquare = [...punnettSquare];
            const newFeedback = [...punnettSquareFeedback]; // IMPORTANT: Copy existing feedback state
            const inputValue = e.target.value.trim();
            const correctValue = correctPunnettSquare[row][col];
            
            newSquare[row][col] = inputValue;
            
            // Helper to sort alleles of a genotype string for comparison
            const sortGenotype = (genotype) => {
              const rAlleles = genotype.split('').filter(a => a.toUpperCase() === 'R').sort().join('');
              const yAlleles = genotype.split('').filter(a => a.toUpperCase() === 'Y').sort().join('');
              return rAlleles + yAlleles;
            };
            
            // Check for correctness only when the input length is 4
            if (inputValue.length === 4) {
              if (sortGenotype(inputValue) !== sortGenotype(correctValue)) {
                // Updated feedback to be more instructional as per user request
                newFeedback[row][col] = "Not quite. To find the correct genotype, look at the female's genotype on the **top** of the column and the male's genotype on the **left** of the row. Combine their alleles to get the right answer for this square.";
              } else {
                newFeedback[row][col] = ''; // Clear feedback if the answer is correct
              }
            } else {
              newFeedback[row][col] = ''; // Clear feedback if input is not a full genotype
            }
            
            setPunnettSquare(newSquare);
            setPunnettSquareFeedback(newFeedback);

            // Check if the entire square is filled correctly
            const isFilled = newSquare.every((rowArr, r) =>
              rowArr.every((cell, c) => cell.length > 0)
            );
            setPunnettSquareFilled(isFilled);
          };

          const handleBack = () => {
            const stepOrder = Object.values(STEPS);
            const currentIndex = stepOrder.indexOf(step);
            if (currentIndex > 0) {
              setStep(stepOrder[currentIndex - 1]);
              setFeedback('');
            }
          };

          const currentQuestion = shuffledQuestions[questionIndex];

          const handleCheckAnswer = () => {
            const trimmedAnswer = userAnswer.trim().toLowerCase();
            const isCorrect = currentQuestion.correctAnswers.some(ans => ans.toLowerCase() === trimmedAnswer);
            
            if (isCorrect) {
              const newCorrectCount = correctAnswersCount + 1;
              setCorrectAnswersCount(newCorrectCount);
              setFeedback('Correct! Great job.');
              setHighlightedCells(currentQuestion.highlight);
              
              if (newCorrectCount >= 10) {
                setShowCongratulations(true);
              }
            } else {
              // Provide a hint instead of the full answer
              setFeedback(`Not quite. ${currentQuestion.hint}`);
              setHighlightedCells([]);
            }
          };

          const handleNextQuestion = () => {
            setUserAnswer('');
            setFeedback('');
            setHighlightedCells([]); // Clear highlights for the next question
            setQuestionIndex((prev) => (prev + 1) % shuffledQuestions.length);
          };
          
          const handleReset = () => {
            setStep(STEPS.INTRO);
            setMaleGameteInputs(['', '', '', '']);
            setMaleGametesCorrect(false);
            setPunnettSquare(Array(4).fill(null).map(() => Array(4).fill('')));
            setPunnettSquareFilled(false);
            setQuestionIndex(0);
            setUserAnswer('');
            setFeedback('');
            setPunnettSquareFeedback(Array(4).fill(null).map(() => Array(4).fill('')));
            setHighlightedCells([]);
            setCorrectAnswersCount(0);
            setShowCongratulations(false);
            setShuffledQuestions([]); // Clear and re-shuffle
            const shuffleArray = (array) => {
              const newArray = [...array];
              for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
              }
              return newArray;
            };
            setShuffledQuestions(shuffleArray(allPracticeQuestions));
          };

          // Renders the final congratulatory screen
          const renderCongratulations = () => {
            const randomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
            return (
              <div className="flex flex-col items-center justify-center h-full text-center p-6 bg-purple-100 rounded-lg shadow-xl">
                <h2 className="text-3xl font-bold text-purple-800 mb-4">Congratulations!</h2>
                <p className="text-xl text-gray-700 mb-6">
                  You've done a great job mastering Dihybrid Crosses. You have answered 10 questions correctly.
                </p>
                <div className="bg-purple-600 text-white font-mono text-2xl tracking-widest px-8 py-4 rounded-lg shadow-lg">
                  {randomCode}
                </div>
                <p className="mt-4 text-sm text-gray-500">
                  This is your unique completion code.
                </p>
                <button
                  onClick={handleReset}
                  className="mt-6 bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors"
                >
                  Go Again
                </button>
              </div>
            );
          };

          const renderStep = () => {
            // If 10 questions are answered correctly, show the congratulatory screen
            if (showCongratulations) {
              return renderCongratulations();
            }

            const stepOrder = Object.values(STEPS);
            const showBackButton = step !== STEPS.INTRO;

            if (step === STEPS.INTRO) {
                return (
                  <>
                    <h2 className="text-xl font-semibold mb-2">Why Dihybrid Cross?</h2>
                    <p className="mb-4">
                      A dihybrid cross is used to study the inheritance of **two different traits** at the same time. For example, we can track the inheritance of both pea shape (round vs. wrinkled) and pea color (yellow vs. green). This is a great way to see how two traits are inherited together.
                    </p>
                    <div className="flex justify-center mt-auto">
                      <button
                        className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                        onClick={() => setStep(STEPS.PROBLEM)}
                      >
                        Next
                      </button>
                    </div>
                  </>
                );
            }

            if (step === STEPS.PROBLEM) {
                return (
                  <>
                    <h2 className="text-xl font-semibold mb-2">The Problem</h2>
                    <p className="mb-4">
                      Let's solve a classic dihybrid cross problem. We will cross two pea plants that are heterozygous for both seed shape and seed color.
                    </p>
                    <div className="flex justify-center items-center my-4 text-2xl font-bold">
                      <span className="bg-green-100 px-4 py-2 rounded-lg">Parents: {parents.female} x {parents.male}</span>
                    </div>
                    <p className="mb-4 text-center">
                      (R = Round, r = wrinkled; Y = Yellow, y = green)
                    </p>
                    <div className="flex justify-between mt-auto w-full">
                      <button
                        className="bg-gray-400 text-white px-6 py-2 rounded-lg hover:bg-gray-500 transition-colors"
                        onClick={handleBack}
                      >
                        Back
                      </button>
                      <button
                        className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                        onClick={() => setStep(STEPS.FEMALE_GAMETES)}
                      >
                        Continue
                      </button>
                    </div>
                  </>
                );
            }

            if (step === STEPS.FEMALE_GAMETES) {
                return (
                  <>
                    <h2 className="text-xl font-semibold mb-2">Independent Assortment</h2>
                    <p className="mb-4">
                      According to the principle of independent assortment, the alleles for one trait separate independently of the alleles for the other trait during gamete formation. This means a gamete can receive any combination of alleles, as long as it gets one allele for each trait.
                    </p>
                    <p className="mb-4 font-bold">
                      The female is heterozygous for both traits, RrYy. Let's combine her alleles to form the **possible genotypes** in her gametes (eggs).
                    </p>
                    <div className="flex flex-col items-center space-y-4">
                      <div className="flex flex-wrap justify-center space-x-8">
                        <div className="bg-yellow-100 p-4 rounded-lg flex flex-col items-center">
                          <span className="font-mono text-lg">Rr</span>
                        </div>
                        <div className="bg-green-100 p-4 rounded-lg flex flex-col items-center">
                          <span className="font-mono text-lg">Yy</span>
                        </div>
                      </div>
                      <div className="flex flex-col items-center mt-4">
                        <p className="mb-2">Combine the alleles to form the possible gametes:</p>
                        <div className="flex flex-col space-y-2 text-xl font-mono">
                          <div className="flex items-center space-x-2">
                            <span className="text-purple-600">R</span><span><span className="text-gray-400 pr-2">with</span>→</span><span className="text-purple-600">Y</span><span className="pl-4">→</span><span className="font-bold text-green-600">RY</span>
                          </div>
                          <div className="flex items-center space-x-2">
                            <span className="text-purple-600">R</span><span><span className="text-gray-400 pr-2">with</span>→</span><span className="text-purple-600">y</span><span className="pl-4">→</span><span className="font-bold text-green-600">Ry</span>
                          </div>
                          <div className="flex items-center space-x-2">
                            <span className="text-purple-600">r</span><span><span className="text-gray-400 pr-2">with</span>→</span><span className="text-purple-600">Y</span><span className="pl-4">→</span><span className="font-bold text-green-600">rY</span>
                          </div>
                          <div className="flex items-center space-x-2">
                            <span className="text-purple-600">r</span><span><span className="text-gray-400 pr-2">with</span>→</span><span className="text-purple-600">y</span><span className="pl-4">→</span><span className="font-bold text-green-600">ry</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div className="flex justify-between mt-auto w-full">
                      <button
                        className="bg-gray-400 text-white px-6 py-2 rounded-lg hover:bg-gray-500 transition-colors"
                        onClick={handleBack}
                      >
                        Back
                      </button>
                      <button
                        className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                        onClick={() => setStep(STEPS.MALE_GAMETES)}
                      >
                        Let's Try It!
                      </button>
                    </div>
                  </>
                );
            }

            if (step === STEPS.MALE_GAMETES) {
                return (
                  <>
                    <h2 className="text-xl font-semibold mb-2">Your Turn: Male Gametes</h2>
                    <p className="mb-4">
                      The male parent has the same genotype: **{parents.male}**. Use the same process to determine all **four unique** possible gametes. Enter them below.
                    </p>
                    <div className="grid grid-cols-2 gap-4">
                      {maleGameteInputs.map((gamete, index) => (
                        <div key={index} className="flex flex-col items-center">
                          <label htmlFor={`gamete-${index}`} className="block mb-1 text-sm font-medium">Gamete {index + 1}</label>
                          <input
                            id={`gamete-${index}`}
                            type="text"
                            value={gamete}
                            onChange={(e) => handleMaleGameteChange(e, index)}
                            className="w-full text-center p-2 rounded-lg border-2 border-gray-300 focus:border-purple-500 focus:outline-none"
                            maxLength="2"
                            placeholder="e.g., RY"
                          />
                        </div>
                      ))}
                    </div>
                    {maleGametesCorrect && (
                      <div className="flex items-center justify-center mt-4 text-green-600 font-semibold">
                        <Check className="mr-2" /> Correct! You have all four gametes.
                      </div>
                    )}
                    {feedback && (
                      <div className={`mt-4 p-3 rounded-lg text-center ${maleGametesCorrect ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                        {feedback}
                      </div>
                    )}
                    <div className="flex justify-between mt-auto w-full">
                      <button
                        className="bg-gray-400 text-white px-6 py-2 rounded-lg hover:bg-gray-500 transition-colors"
                        onClick={handleBack}
                      >
                        Back
                      </button>
                      <button
                        className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors disabled:bg-gray-400"
                        onClick={() => setStep(STEPS.PUNNETT_SQUARE_SETUP)}
                        disabled={!maleGametesCorrect}
                      >
                        Continue to Punnett Square
                      </button>
                    </div>
                  </>
                );
            }

            if (step === STEPS.PUNNETT_SQUARE_SETUP) {
                return (
                  <>
                    <h2 className="text-xl font-semibold mb-2">Punnett Square Setup</h2>
                    <p className="mb-4">
                      Now we'll use a Punnett Square to find all possible offspring genotypes.
                    </p>
                    <div className="p-4 bg-gray-100 rounded-lg shadow-inner">
                      <div className="w-full text-center mb-2 font-semibold">Female's Possible Egg Combinations</div>
                      <div className="flex w-full justify-center">
                        <div className="flex flex-col justify-around text-center mr-2 font-semibold [writing-mode:vertical-lr] [text-orientation:sideways-right] leading-none whitespace-nowrap">
                          Male's Possible Sperm Combinations
                        </div>
                        <div className="grid grid-cols-5 gap-2 text-center flex-grow">
                          {/* Top-left empty corner */}
                          <div className="w-12 h-12"></div>
                          {/* Female Gametes Header Row */}
                          {correctGametes.map((gamete, index) => (
                            <div key={`female-${index}`} className="w-12 h-12 flex items-center justify-center font-bold text-purple-600 border-b-2 border-purple-500">
                              {gamete}
                            </div>
                          ))}
                          {/* Male Gametes Column and Punnett Square Grid */}
                          {correctGametes.map((gamete, rIndex) => (
                            <React.Fragment key={`row-${rIndex}`}>
                              <div className="w-12 h-12 flex items-center justify-center font-bold text-purple-600 border-r-2 border-purple-500">
                                {gamete}
                              </div>
                              {Array.from({ length: 4 }).map((_, cIndex) => (
                                <div key={`${rIndex}-${cIndex}`} className="w-12 h-12 bg-white rounded-md flex items-center justify-center border border-gray-300 text-sm">
                                  
                                </div>
                              ))}
                            </React.Fragment>
                          ))}
                        </div>
                      </div>
                    </div>
                    <div className="flex justify-between mt-auto w-full">
                      <button
                        className="bg-gray-400 text-white px-6 py-2 rounded-lg hover:bg-gray-500 transition-colors"
                        onClick={handleBack}
                      >
                        Back
                      </button>
                      <div className="flex space-x-2">
                        <button
                          className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                          onClick={() => setStep(STEPS.PUNNETT_SQUARE_FILL)}
                        >
                          Let's Fill It In!
                        </button>
                        <button
                          className="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors"
                          onClick={() => setStep(STEPS.PRACTICE_PROBLEMS)}
                        >
                          Skip to Practice Problems
                        </button>
                      </div>
                    </div>
                  </>
                );
            }
            
            if (step === STEPS.PUNNETT_SQUARE_FILL) {
                return (
                  <>
                    <h2 className="text-xl font-semibold mb-2">Fill the Punnett Square</h2>
                    <p className="mb-4">
                      Fill in each square by combining the alleles from the top row and the left column to find the resulting offspring **genotype**.
                    </p>
                    <div className="p-4 bg-gray-100 rounded-lg shadow-inner">
                      <div className="w-full text-center mb-2 font-semibold">Female's Possible Egg Combinations</div>
                      <div className="flex w-full justify-center">
                        <div className="flex flex-col justify-around text-center mr-2 font-semibold [writing-mode:vertical-lr] [text-orientation:sideways-right] leading-none whitespace-nowrap">
                          Male's Possible Sperm Combinations
                        </div>
                        <div className="grid grid-cols-5 gap-2 text-center flex-grow">
                          {/* Top-left empty corner */}
                          <div className="w-12 h-12"></div>
                          {/* Female Gametes Header Row */}
                          {correctGametes.map((gamete, index) => (
                            <div key={`female-${index}`} className="w-12 h-12 flex items-center justify-center font-bold text-purple-600 border-b-2 border-purple-500">
                              {gamete}
                            </div>
                          ))}
                          {/* Male Gametes Column and Punnett Square Grid */}
                          {correctGametes.map((gamete, rIndex) => (
                            <React.Fragment key={`row-${rIndex}`}>
                              <div className="w-12 h-12 flex items-center justify-center font-bold text-purple-600 border-r-2 border-purple-500">
                                {gamete}
                              </div>
                              {Array.from({ length: 4 }).map((_, cIndex) => (
                                <div key={`${rIndex}-${cIndex}`} className="relative bg-white rounded-md h-12 flex flex-col items-center justify-center border-2 border-gray-300">
                                  <input
                                    type="text"
                                    value={punnettSquare[rIndex][cIndex]}
                                    onChange={(e) => handlePunnettSquareChange(e, rIndex, cIndex)}
                                    className={`w-full h-full text-center p-1 rounded-lg focus:border-purple-500 focus:outline-none text-sm
                                      ${punnettSquareFeedback[rIndex][cIndex] ? 'border-red-500' : 'border-gray-300'}`}
                                    maxLength="4"
                                  />
                                   {punnettSquareFeedback[rIndex][cIndex] && (
                                    <div className="absolute top-full mt-1 w-48 p-2 text-xs text-left bg-red-100 text-red-700 rounded-lg shadow-lg z-10">
                                      {punnettSquareFeedback[rIndex][cIndex]}
                                    </div>
                                  )}
                                </div>
                              ))}
                            </React.Fragment>
                          ))}
                        </div>
                      </div>
                      {feedback && (
                        <div className={`mt-4 p-3 rounded-lg ${feedback.startsWith('Correct') ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                          {feedback}
                        </div>
                      )}
                    </div>
                    <div className="flex justify-between mt-auto w-full">
                      <button
                        className="bg-gray-400 text-white px-6 py-2 rounded-lg hover:bg-gray-500 transition-colors"
                        onClick={handleBack}
                      >
                        Back
                      </button>
                      {punnettSquareFilled && (
                        <button
                          className="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors"
                          onClick={() => setStep(STEPS.PRACTICE_PROBLEMS)}
                        >
                          Continue to Practice Problems
                        </button>
                      )}
                    </div>
                  </>
                );
            }

            if (step === STEPS.PRACTICE_PROBLEMS) {
                return (
                  <>
                    <h2 className="text-xl font-semibold mb-2">Practice Problems</h2>
                    <p className="mb-4">
                      Now that the Punnett Square is complete, let's use it to answer some questions about the offspring.
                    </p>
                    {/* Display completed Punnett Square here */}
                    <div className="p-4 bg-gray-100 rounded-lg shadow-inner mb-6">
                      <div className="w-full text-center mb-2 font-semibold">Female's Possible Egg Combinations</div>
                      <div className="flex w-full justify-center">
                        <div className="flex flex-col justify-around text-center mr-2 font-semibold [writing-mode:vertical-lr] [text-orientation:sideways-right] leading-none whitespace-nowrap">
                          Male's Possible Sperm Combinations
                        </div>
                        <div className="grid grid-cols-5 gap-2 text-center flex-grow">
                          {/* Top-left empty corner */}
                          <div className="w-12 h-12"></div>
                          {/* Female Gametes Header Row */}
                          {correctGametes.map((gamete, index) => (
                            <div key={`female-${index}`} className="w-12 h-12 flex items-center justify-center font-bold text-purple-600 border-b-2 border-purple-500">
                              {gamete}
                            </div>
                          ))}
                          {/* Male Gametes Column and Punnett Square Grid */}
                          {correctGametes.map((gamete, rIndex) => (
                            <React.Fragment key={`row-${rIndex}`}>
                              <div className="w-12 h-12 flex items-center justify-center font-bold text-purple-600 border-r-2 border-purple-500">
                                {gamete}
                              </div>
                              {Array.from({ length: 4 }).map((_, cIndex) => {
                                const isHighlighted = highlightedCells.some(cell => cell.row === rIndex && cell.col === cIndex);
                                return (
                                  <div
                                    key={`${rIndex}-${cIndex}`}
                                    className={`w-12 h-12 bg-white rounded-md flex items-center justify-center border border-gray-300 text-sm font-mono transition-all duration-300
                                      ${isHighlighted ? 'border-yellow-400 border-4 shadow-md' : ''}`}
                                  >
                                    {correctPunnettSquare[rIndex][cIndex]}
                                  </div>
                                );
                              })}
                            </React.Fragment>
                          ))}
                        </div>
                      </div>
                    </div>
                    <div className="bg-gray-100 p-6 rounded-lg">
                      {currentQuestion && (
                        <>
                          <p className="text-sm font-medium mb-2">
                            Problem {questionIndex + 1}
                            <span className="text-sm text-gray-500 ml-2">(Correct: {correctAnswersCount}/10)</span>
                          </p>
                          <p className="text-lg font-bold mb-4">{currentQuestion.text}</p>
                          <div className="flex items-center space-x-2">
                            <input
                              type="text"
                              value={userAnswer}
                              onChange={(e) => setUserAnswer(e.target.value)}
                              className="w-1/2 p-2 rounded-lg border-2 border-gray-300 focus:border-purple-500 focus:outline-none"
                              placeholder="Your answer"
                            />
                            <button
                              onClick={handleCheckAnswer}
                              className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                            >
                              Check Answer
                            </button>
                            <button
                              onClick={handleNextQuestion}
                              className="bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500 transition-colors"
                            >
                              Next Question
                            </button>
                          </div>
                          {feedback && (
                            <div className={`mt-4 p-3 rounded-lg ${feedback.startsWith('Correct') ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                              {feedback}
                            </div>
                          )}
                        </>
                      )}
                    </div>
                    <div className="flex justify-start mt-auto w-full">
                      <button
                        className="bg-gray-400 text-white px-6 py-2 rounded-lg hover:bg-gray-500 transition-colors"
                        onClick={handleBack}
                      >
                        Back
                      </button>
                    </div>
                  </>
                );
            }
          };
          
          return (
            <div className="flex flex-col h-full">
              {renderStep()}
            </div>
          );
        };
        
        const rootElement = document.getElementById('root');
        const root = createRoot(rootElement);
        root.render(<App />);

    </script>
</body>
</html>
